<!-- src/app/vacation/vacation.component.html -->

<div class="vacation-container">
  <!-- Mensajes -->
  <div *ngIf="successMessage" class="alert alert-success">âœ“ {{ successMessage }}</div>
  <div *ngIf="errorMessage" class="alert alert-error">âœ— {{ errorMessage }}</div>

  <!-- Header -->
  <div class="header">
    <h1>ğŸ–ï¸ Mis Vacaciones</h1>
    <button class="btn-primary" (click)="createNewVacation()" *ngIf="!showForm">
      + Nueva VacaciÃ³n
    </button>
  </div>

  <!-- Formulario -->
  <div *ngIf="showForm" class="form-card">
    <div class="form-header">
      <h2>{{ getFormTitle() }}</h2>
      <button class="btn-close" (click)="cancelForm()">âœ•</button>
    </div>

    <div class="form-group">
      <label>TÃ­tulo <span class="required">*</span></label>
      <input type="text" [(ngModel)]="formData.titulo" placeholder="Ej: Vacaciones en Cartagena">
      <div *ngIf="submitted && (!formData.titulo || formData.titulo.length < 3)" class="error">
        MÃ­nimo 3 caracteres
      </div>
    </div>

    <div class="form-group">
      <label>Lugar <span class="required">*</span></label>
      <input type="text" [(ngModel)]="formData.lugar" placeholder="Ej: Cartagena de Indias">
      <div *ngIf="submitted && (!formData.lugar || formData.lugar.length < 3)" class="error">
        MÃ­nimo 3 caracteres
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>Fecha Inicio <span class="required">*</span></label>
        <input type="date" [(ngModel)]="formData.fechaInicio">
        <div *ngIf="submitted && !formData.fechaInicio" class="error">Requerido</div>
      </div>
      <div class="form-group">
        <label>Fecha Fin <span class="required">*</span></label>
        <input type="date" [(ngModel)]="formData.fechaFin">
        <div *ngIf="submitted && !formData.fechaFin" class="error">Requerido</div>
      </div>
    </div>

    <div *ngIf="formData.fechaInicio && formData.fechaFin" class="duration-info">
      ğŸ—“ï¸ DuraciÃ³n: {{ getDuration(formData.fechaInicio, formData.fechaFin) }} dÃ­as
    </div>

    <div class="form-group">
      <label>Presupuesto (COP) <span class="required">*</span></label>
      <input type="number" [(ngModel)]="formData.presupuesto" placeholder="0" min="0">
      <div *ngIf="submitted && formData.presupuesto <= 0" class="error">Debe ser mayor a 0</div>
    </div>

    <div class="form-group">
      <label>DescripciÃ³n <span class="required">*</span></label>
      <textarea [(ngModel)]="formData.descripcion" rows="5" placeholder="Describe tu plan..."></textarea>
      <div class="char-count">{{ formData.descripcion?.length || 0 }} / 2000</div>
      <div *ngIf="submitted && (!formData.descripcion || formData.descripcion.length < 10)" class="error">
        MÃ­nimo 10 caracteres
      </div>
    </div>

    <div class="form-actions">
      <button class="btn-cancel" (click)="cancelForm()">Cancelar</button>
      <button class="btn-save" (click)="saveVacation()" [disabled]="loading">
        {{ loading ? 'Guardando...' : (editingId ? 'Actualizar' : 'Crear') }}
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading && !showForm" class="loading">
    <div class="spinner"></div>
    <p>Cargando...</p>
  </div>

  <!-- Lista de vacaciones -->
  <div *ngIf="!loading && vacations.length > 0 && !showForm" class="vacation-grid">
    <div *ngFor="let vacation of vacations" class="vacation-card">
      <div class="card-header">
        <h3>{{ vacation.titulo }}</h3>
        <span class="badge">{{ getDuration(vacation.fechaInicio, vacation.fechaFin) }} dÃ­as</span>
      </div>

      <div class="card-body">
        <div class="info-row">
          <span>ğŸ“</span>
          <span>{{ vacation.lugar }}</span>
        </div>
        <div class="info-row">
          <span>ğŸ“…</span>
          <span>{{ formatDate(vacation.fechaInicio) }} - {{ formatDate(vacation.fechaFin) }}</span>
        </div>
        <div class="info-row">
          <span>ğŸ’°</span>
          <span class="budget">{{ formatBudget(vacation.presupuesto) }}</span>
        </div>
        <p class="description">{{ vacation.descripcion }}</p>
      </div>

      <div class="card-actions">
        <button class="btn-edit" (click)="editVacation(vacation)">âœï¸ Editar</button>
        <button class="btn-delete" (click)="deleteVacation(vacation.id!, vacation.titulo)">ğŸ—‘ï¸ Eliminar</button>
      </div>
    </div>
  </div>

  <!-- Estado vacÃ­o -->
  <div *ngIf="!loading && vacations.length === 0 && !showForm" class="empty-state">
    <div class="empty-icon">ğŸï¸</div>
    <h2>No hay vacaciones planeadas</h2>
    <p>Â¡Comienza a planear tu prÃ³xima aventura!</p>
    <button class="btn-primary" (click)="createNewVacation()">Crear mi primera vacaciÃ³n</button>
  </div>
</div>
